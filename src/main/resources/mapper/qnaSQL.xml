<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="qna">
  	<select id="selectAllQna" parameterType="map" resultType="q">
  		select rownum as rnum, q.* from
		    (select 
		        qna_no as qnaNo,
		        qna_title as qnaTitle,
		        substr(qna_writer,1,length(qna_writer)-3) || lpad('*',3,'*') as qnaWriter,
		        secret_status as secretStatus,
		        qna_content as qnaContent,
		        qna_date as qnaDate,
		        qna_comment as qnaComment,
		        qna_comment_writer as qnaCommentWriter,
		        comment_date as commnetDate,
		        comment_status as commentStatus,
		        qna_theme as qnaTheme,
		        read_cnt as readCnt
		    from qna_tbl)q where rownum between #{start} and #{end} order by 1 desc
  	</select>
  	
  	<insert id="insertQna" parameterType="q">
  		insert into
  		qna_tbl values(qna_seq.nextval, #{qnaTitle}, #{qnaWriter}, #{secretStatus}, #{qnaContent}, to_char(sysdate, 'yyyy-mm-dd'), null, null, null, 0, #{qnaTheme}, 0)
  	</insert>
  	
  	<insert id="insertQnaFile" parameterType="qf">
  		insert into
  		qna_file values(qna_file_seq.nextval, #{qnaNo}, #{filename}, #{filepath})
  	</insert>
  	
  	<select id="selectMaxNo" resultType="int">
  		select max(qna_no) from qna_tbl
  	</select>
</mapper>
