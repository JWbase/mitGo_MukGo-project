<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="store">

	<insert id="addStore" parameterType="s">
		insert into store
		values
		(store_seq.nextval,
		#{storeName},
		2,
		#{address},
		#{phone},
		#{content},
		#{openHour},
		#{closedDay},
		0,
		0,
		#{category},
		#{withEatCate},
		#{whereEatCate}
		)
	</insert>

	<select id="selectStoreNo" resultType="_int">
		select max(store_no) as storeNo
		from store
	</select>

	<insert id="insertImg" parameterType="si">
		insert into store_img
		values
		(storeimg_seq.nextval,
		#{storeNo},
		#{imgpath}
		)
	</insert>

	<insert id="reviewWrite" parameterType="r">
		insert into review
		values
		(review_seq.nextval,
		#{menuNo},
		#{write},
		#{rating},
		#{reviewImg},
		to_char(sysdate, 'yyyy-mm-dd')
		)
	</insert>

	<select id="storeList" resultType="s">
	select
	    store_no as storeNo,
	    store_name as storeName,
	    owner_no as ownerNo,
	    address,
	    phone,
	    content,
	    open_hour as openHour,
	    closed_day as closedDay,
	    rating,
	    review_count as reviewCount,
	    category,
	    whitheat_cate as
	    withEatCate,
	    whereeat_cate as whereEatCate,
	    (select imgpath from store_img si where storeimg_no = (select min(storeimg_no) from store_img si2 where si2.store_no = s.store_no)) as thumbNail
	from store s order by storeNo desc
	</select>
	
	<select id="selectOneStore" parameterType="s" resultType="s">
		select
			store_name as storeName,
			open_hour as openHour,
			address,
			phone,
			closed_day as closedDay
		from store 
		where store_no =84
	</select>
</mapper>