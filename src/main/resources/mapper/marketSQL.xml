<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="market">
	<select id="marketList" parameterType="map" resultType="ma">
		select * from
            (select row_number() over (order by rnum desc) as rnum1, rb.* from
            (select rownum as rnum, b.* from
            (select
			p_no as pNo,
			owner_no as ownerNo,
			(select store_Name from store s where s.owner_no = m.owner_no) as storeName,
			p_name as pName,
			p_price as pPrice,
			p_img as pImg
		from market_product m order by pno desc)b)rb order by 3 desc)where rnum between #{start} and #{end}
	</select>
	
	<insert id="addMarketProduct" parameterType="ma">
		insert into market_product values(mp_seq.nextval,
			#{ownerNo},
			#{pName},
			#{pPrice},
			#{pContent},
			#{pImg},
			#{storeNo},
			#{pCategory}
		)
	</insert>
	
	<select id="marketProductList" parameterType="int" resultType="ma">
        select 
            p_no as pNo,
			owner_no as ownerNo,
			p_name as pName,
			p_price as pPrice,
			p_img as pImg,
			store_no as storeNo,
			pCategory,
            cate_name as cateName
            from Category c, market_product m 
            where c.cate_no = m.pcategory and store_no = #{storeNo}
	</select>
	
	<select id="deleteMarketProduct" parameterType="int">
		 delete from market_product 
		 where p_no = #{_parameter}
	</select>
	
	
	<select id="selectOneMarket" parameterType="_int" resultType="ma">
		select
			p_no as pNo,
			owner_no as ownerNo,
			p_name as pName,
			p_price as pPrice,
			p_content as pContent,
			p_img as pImg,
			store_no as storeNo
		from market_product
		where p_no= 24
	</select>
	
	<select id="readOneMarketProduct" parameterType="int" resultType="ma">
		select
			p_no as pNo,
			owner_no as ownerNo,
			p_name as pName,
			p_price as pPrice,
			p_content as pContent,
			p_img as pImg,
			store_no as storeNo,
			pCategory
		from market_product
		where p_no = #{_parameter}
	</select>
	
	<update id="updateMarketProduct" parameterType="ma">
		update market_product
		set
			p_name = #{pName},
			p_price = #{pPrice},
			p_content = #{pContent},
			p_img = #{pImg},
			pcategory = #{pCategory}
		where p_no = #{pNo}
	</update>
</mapper>
